<html>
<!--<script src="src/amplitude-snippet.js" type="text/javascript"></script>-->
<script>
    (function(window, document) {
      var amplitude = window.amplitude || {'_q':[], '_iq':{}};
      var as = document.createElement('script');
      as.type = 'text/javascript';
      as.async = true;
      as.src = '/amplitude.js';
      as.onload = function() {window.amplitude.runQueuedFunctions();};
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(as, s);
      var Identify = function() {this._q = []; return this;};
      function proxyIdentify(fn) {
        Identify.prototype[fn] = function() {
          this._q.push([fn].concat(Array.prototype.slice.call(arguments, 0))); return this;
        };
      }
      var identifyFuncs = ['add', 'append', 'clearAll', 'set', 'setOnce', 'unset'];
      for (var i = 0; i < identifyFuncs.length; i++) {proxyIdentify(identifyFuncs[i]);}
      amplitude.Identify = Identify;
      var funcs = ['init', 'logEvent', 'logRevenue', 'setUserId', 'setUserProperties',
                   'setOptOut', 'setVersionName', 'setDomain', 'setDeviceId',
                   'setGlobalUserProperties', 'identify', 'clearUserProperties'];
      function setUpProxy(instance) {
        function proxy(fn) {
          instance[fn] = function() {
            instance._q.push([fn].concat(Array.prototype.slice.call(arguments, 0)));
          };
        }
        for (var j = 0; j < funcs.length; j++) {proxy(funcs[j]);}
      }
      setUpProxy(amplitude);
      amplitude.getInstance = function(instance) {
        instance = ((!instance || instance.length === 0) ? '$default_instance' : instance).toLowerCase();
        if (!amplitude._iq.hasOwnProperty(instance)) {
          amplitude._iq[instance] = {'_q':[]}; setUpProxy(amplitude._iq[instance]);
        }
        return amplitude._iq[instance];
      };
      window.amplitude = amplitude;
    })(window, document);

    var setUserId = function() {
        var userId = prompt('Input userId', 'user01');
        amplitude.setUserId(userId);
    };
    var setEventUploadThreshold = function() {
        var eventUploadThreshold = parseInt(prompt('Input eventUploadThreshold', 5));
        amplitude.options.eventUploadThreshold = eventUploadThreshold;
    };
    var logEvent = function() {
        var event = prompt('Input event type', 'clicked');
        amplitude.logEvent(event);
    };
    var setCity = function() {
        var city = prompt('Input city', 'San Francisco, CA');
        amplitude.setUserProperties({city: city});
    };
    var addToPhotoCount = function() {
        var photoCount = parseInt(prompt('Input amount to increment photo count by', '2'), 10);
        amplitude.identify(new amplitude.Identify().add('photoCount', photoCount));
    }
    var clickOnLinkA = function() {
        amplitude.logEvent('Clicked on link A', null, function() { window.location='https://www.google.com'; });
    };
    var setPhotoCount = function() {
        var photoCount = parseInt(prompt('Input photo count to set', '2'), 10);
        amplitude.identify(new amplitude.Identify().set('photoCount', photoCount));
    }
    var setOncePhotoCount = function() {
        var photoCount = parseInt(prompt('Input photo count to setOnce', '2'), 10);
        amplitude.identify(new amplitude.Identify().setOnce('photoCount', photoCount));
    }
</script>
<script>
    amplitude.init('a2dbce0e18dfe5f8e74493843ff5c053', null, {includeReferrer: true}, function() {
        alert(amplitude.getInstance().options.deviceId);
    });
    amplitude.setVersionName('Web');
    amplitude.identify(new amplitude.Identify().add('photoCount', 1));
    amplitude.identify(new amplitude.Identify().add('photoCount', 1).set('gender', 'male').unset('karma'));
    amplitude.logEvent('pageLoad');
</script>
<body>
<h3>Amplitude JS Test</h3>
<ul>
    <li><a href="javascript:setUserId();">Set user ID</a></li>
    <li><a href="javascript:amplitude.setOptOut(!amplitude.options.optOut);">Toggle opt out</a></li>
    <li><a href="javascript:logEvent();">Log event</a></li>
    <li><a href="javascript:amplitude.logEvent('clicked button', {color: 'red;', shape: 'triangle', sides: 3});">Log
        event with event properties</a></li>
    <li><a href="javascript:amplitude.setUserProperties({age: 30, city: 'San Francisco, CA'});">Set user properties</a></li>
    <li><a href="javascript:amplitude.options.batchEvents = !amplitude.options.batchEvents;">Toggle batch events</a></li>
    <li><a href="javascript:setEventUploadThreshold();">Set event upload threshold</a></li>
    <li><a href="javascript:clickOnLinkA();">Click on link A</a></li>
    <br><br>Testing Identify calls<br>
    <li><a href="javascript:addToPhotoCount();">Add to photo count</a></li>
    <li><a href="javascript:amplitude.identify(new amplitude.Identify().unset('photoCount'));">Unset photo count</a></li>
    <li><a href="javascript:setPhotoCount();">Set photo count</a></li>
    <li><a href="javascript:setOncePhotoCount();">Set photo count once</a></li>
    <li><a href="javascript:setCity();">Set city via setUserProperties</a></li>
    <li><a href="javascript:amplitude.clearUserProperties();">Clear all user properties</a></li>
    <br><br>
    <li><a href="/test/browser/amplitudejs.html">Go to first page</a></li>
</body>
</html>
